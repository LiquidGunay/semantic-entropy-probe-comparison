[phases.setup]
# Use Python 3.12 and a minimal base; uv will be installed via pip.
nixPackages = ["python312", "pip"]

[phases.install]
cmds = [
  "pip install --upgrade pip uv",
  "uv sync --frozen --no-dev"
]

[phases.build]
cmds = []

[phases.start]
cmd = "./scripts/serve_probe_analysis.sh"

[variables]
# Keep joblib single-threaded to avoid /dev/shm issues on Railway.
NUMBA_NUM_THREADS = "1"
OMP_NUM_THREADS = "1"
JOBLIB_MULTIPROCESSING = "0"
LOKY_MAX_CPU_COUNT = "1"
JOBLIB_TEMP_FOLDER = "/tmp"
UV_CACHE_DIR = "/tmp/.uv-cache"
UV_LINK_MODE = "copy"
